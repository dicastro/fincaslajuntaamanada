<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="author" content="Diego Castro">
        <meta name="description" content="Fake site">
        <title>Fincas La Junta Amañada</title>
        <link data-n-head="ssr" rel="icon" type="image/x-icon" href="favicon.ico">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.4.1/materia/bootstrap.min.css" rel="stylesheet" integrity="sha384-1tymk6x9Y5K+OF0tlmG2fDRcn67QGzBkiM3IgtJ3VrtGrIi5ryhHjKjeeS60f1FA" crossorigin="anonymous">
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link href="custom.css" rel="stylesheet">

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
        
        <style>
            code {
                font-size: unset;
                color: unset;
            }
        </style>
    </head>
    <body>
        <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
            <h5 class="my-0 mr-md-auto font-weight-normal">
                <img src="fincas_la_junta_amañada.svg">
                Fincas La Junta Amañada
            </h5>
            <nav class="my-2 my-md-0 mr-md-3">
            </nav>
        </div>

        <div class="container py-5 text-center">
            <h2>Bienvenido a la web de Fincas La Junta Amañada</h2>
            <p class="lead">En este sitio podrás realizar múltiples acciones: confirmar deudas pendientes, validar si nuestro número de cuenta bancaria es correcto, saldar deudas a través de justificantes de pago.</p>
        </div>

        <div class="container">
            <div class="row justify-content-md-center">
                <div class="col-md-4 order-md-2 mb-4">
                    <h4>Morosos del día</h4>
                    <div id="defaultersoftheday" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="raquel01.jpeg" class="d-block w-100" alt="...">
                            </div>
                            <div class="carousel-item">
                                <img src="jesus01.jpeg" class="d-block w-100" alt="...">
                            </div>
                        </div>
                        <a class="carousel-control-prev" href="#defaultersoftheday" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Anterior</span>
                        </a>
                        <a class="carousel-control-next" href="#defaultersoftheday" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Siguiente</span>
                        </a>
                    </div>
                </div>

                <div class="col-md-8 order-md-1">
                    <form id="debtamountconfirmationform" class="needs-validation mb-3" novalidate="" onsubmit="return false;">
                        <h4>Confirma tu deuda pendiente</h4>
                
                        <div class="mb-3">
                            <label for="debtamount">Introduce el importe que se debe</label>
                            <input type="text" class="form-control" id="debtamount" placeholder="111.22">
                        </div>

                        <button class="btn btn-primary btn-lg btn-block" type="button" id="checkdebtamount">Confirmar deuda</button>
                    </form>

                    <form id="ccconfirmationform" class="needs-validation mb-3" novalidate="" onsubmit="return false;">
                        <h4>Valida nuestra cuenta bancaria</h4>
                
                        <div class="row mb-3">
                            <div class="col-md-2 mb-1">
                                <label for="ccblock1">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock1" placeholder="ESXX">
                            </div>
                            <div class="col-md-2 mb-1">
                                <label for="ccblock2">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock2" placeholder="XXXX">
                            </div>
                            <div class="col-md-2 mb-1">
                                <label for="ccblock3">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock3" placeholder="XXXX">
                            </div>
                            <div class="col-md-2 mb-1">
                                <label for="ccblock4">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock4" placeholder="XXXX">
                            </div>
                            <div class="col-md-2 mb-1">
                                <label for="ccblock5">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock5" placeholder="XXXX">
                            </div>
                            <div class="col-md-2 mb-1">
                                <label for="ccblock6">&nbsp;</label>
                                <input type="text" class="form-control ccblock" id="ccblock6" placeholder="XXXX">
                            </div>
                        </div>

                        <button class="btn btn-primary btn-lg btn-block" type="button" id="checkcc">Validar cuenta</button>
                    </form>

                    <form id="paymentreceiptform" class="needs-validation mb-3" novalidate="" onsubmit="return false;">
                        <h4>Saldar deuda con justificante de pago</h4>
                
                        <div class="mb-3">
                            <label for="paymentreceiptid">En caso de disponer de un justificante de pago, introduzca aquí su número de identificador</label>
                            <input type="text" class="form-control" id="paymentreceiptid" placeholder="XXXXXX">
                        </div>

                        <button class="btn btn-primary btn-lg btn-block" type="button" id="checkpaymentreceipt" data-toggle="modal" data-target="#checkpaymentreceiptresult">Saldar deuda</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="debtamountincorrect" tabindex="-1" role="dialog" aria-labelledby="debtamountincorrectLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="debtamountincorrectLabel">Resultado</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="result">
                            <p>En nuestro sistema informático consta otra deuda</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="ccincorrect" tabindex="-1" role="dialog" aria-labelledby="ccincorrectLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="ccincorrectLabel">Resultado</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="result">
                            <p>El número de cuenta no es correcto</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="checkpaymentreceiptresult" tabindex="-1" role="dialog" aria-labelledby="checkpaymentreceiptresultLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="checkpaymentreceiptresultLabel">Resultado</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="result">
                            <p></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            $(document).ready(function() {
                // debt confirmation
                function debtconfirmedAction() {
                    $('#debtamountconfirmationform').replaceWith('<div class="alert alert-success" role="alert">Deuda confirmada de <b>800€</b> por parte de <b>Raquel Castro</b> y <b>Jesús Sobrino</b></div>')
                }

                $('#debtamount').on('keyup', function(event) {
                    if (event.keyCode === 13) {
                        event.preventDefault()
                        $('#checkdebtamount').click()
                    }
                })

                $('#checkdebtamount').on('click', function(event) {
                    event.preventDefault()

                    var debtamount = $('#debtamount').val().replace(/,/g, '.')
                    
                    if (debtamount === '800' || debtamount === '800.0' || debtamount === '800.00' || debtamount === '800.000' || debtamount === '800.0000') {
                        sessionStorage.setItem('debtconfirmed', true);
                        debtconfirmedAction()
                    } else {
                        $('#debtamountincorrect').modal()
                    }
                })

                if (sessionStorage.getItem('debtconfirmed')) {
                    debtconfirmedAction()
                }

                // account confirmation
                function ccconfirmedAction() {
                    $('#ccconfirmationform').replaceWith('<div class="alert alert-success" role="alert">Número de cuenta confirmado: <code>ES92-3067-2343-1111-5678-9652</code>. Recordad que hay que hacer el ingreso en efectivo, quizás necesitéis usar vuestros <b><i>ahorros para imprevistos</i></b>.</div>')
                }

                $('#ccblock').on('keyup', function(event) {
                    if (event.keyCode === 13) {
                        event.preventDefault()
                        $('#checkcc').click()
                    }
                })

                $('#checkcc').on('click', function(event) {
                    event.preventDefault()

                    var ccblock1 = $('#ccblock1').val()
                    var ccblock2 = $('#ccblock2').val()
                    var ccblock3 = $('#ccblock3').val()
                    var ccblock4 = $('#ccblock4').val()
                    var ccblock5 = $('#ccblock5').val()
                    var ccblock6 = $('#ccblock6').val()
                    
                    var cc = ccblock1 + '-' + ccblock2 + '-' + ccblock3 + '-' + ccblock4 + '-' + ccblock5 + '-' + ccblock6

                    if (cc === 'ES92-3067-2343-1111-5678-9652') {
                        sessionStorage.setItem('ccconfirmed', true);
                        ccconfirmedAction()
                    } else {
                        $('#ccincorrect').modal()
                    }
                })

                if (sessionStorage.getItem('ccconfirmed')) {
                    ccconfirmedAction()
                }

                // justify debt
                
                $('#paymentreceiptid').on('keyup', function(event) {
                    if (event.keyCode === 13) {
                        event.preventDefault()
                        $('#checkpaymentreceipt').click()
                    }
                })

                $('#checkpaymentreceiptresult').on('show.bs.modal', function (event) {
                    var modal = $(this)

                    if (!sessionStorage.getItem('debtconfirmed')) {
                        modal.find('.modal-body #result p').text('Pero si todavía no sabes lo que debes! No quieras correr tanto')
                    } else {
                        var paymentreceiptid = $('#paymentreceiptid').val()

                        if (paymentreceiptid === 'RYJ800') {
                            event.preventDefault()
                            sessionStorage.setItem('paymentjustified', true);
                            window.location = 'congratulations.html'
                        } else {
                            modal.find('.modal-body #result p').text('El justificante es incorrecto')
                        }
                    }
                })

                var urlParams = new URLSearchParams(window.location.search);

                if (urlParams.has('reset') && urlParams.get('reset')) {
                    sessionStorage.setItem('paymentjustified', false);
                    sessionStorage.setItem('ccconfirmed', false);
                    sessionStorage.setItem('debtconfirmed', false);
                }

                if (urlParams.has('solve') && urlParams.get('solve')) {
                    sessionStorage.setItem('paymentjustified', true);
                    sessionStorage.setItem('ccconfirmed', true);
                    sessionStorage.setItem('debtconfirmed', true);
                }

                if (sessionStorage.getItem('paymentjustified') && sessionStorage.getItem('paymentjustified') === "true") {
                    if (!urlParams.has('force') || !urlParams.get('force')) {
                        window.location = 'congratulations.html'
                    }
                }
            })
        </script>
    </body>
</html>
